module.exports = function(db, params, options) {
  
  // Fetch Database
  var stmt = db.prepare(`SELECT * FROM ${options.table} WHERE ID IS NOT NULL`);
  let resp = [];
  for (var row of stmt.iterate()) {
    if (!row.ID.startsWith(params.str)) continue;
    try {
      resp.push({
        ID: row.ID,
        data: JSON.parse(JSON.parse(row.json))
      })
    } catch (e) {}
  }
  
  // Sort
  if (params.ops.sortBy) {
    if (params.ops.sortBy[0] == '.') params.ops.sortBy = params.ops.sortBy.slice(1);
    resp = resp.sort((a,b) => b.data[params.ops.sortBy] - a.data[params.ops.sortBy]);
  } else if (params.ops.sort) resp = resp.sort((a,b) => b.data - a.data);
  
  return resp;
  
}